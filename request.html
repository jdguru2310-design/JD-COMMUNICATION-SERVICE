<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Request Service — JD Communication Services</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <header class="header">
      <div class="brand">
        <img src="assets/jd-logo.svg" class="logo" alt="JD logo">
        <div><h1>JD Communication Services</h1></div>
      </div>
      <nav class="nav"><a href="index.html">Home</a><a href="services.html">Services</a><a href="request.html">Request</a></nav>
    </header>

    <main style="margin-top:18px">
      <h2>Request a Service</h2>
      <p class="muted">Select service and upload required documents. After submission you will see a confirmation message.</p>

      <!-- SIMPLE FORM (file uploads optional) -->
      <form id="serviceForm" class="card" enctype="multipart/form-data">
        <div class="form-row">
          <label for="name">Full Name</label>
          <input id="name" name="from_name" type="text" class="input" required>
        </div>

        <div class="form-row">
          <label for="phone">Phone Number</label>
          <input id="phone" name="phone" type="tel" class="input" required>
        </div>

        <div class="form-row">
          <label for="service">Service Type</label>
          <select id="service" name="service" class="input" required>
            <option value="">-- Select a Service --</option>
            <option value="Community Certificate">Community Certificate</option>
            <option value="Income Certificate">Income Certificate</option>
            <option value="Nativity Certificate">Nativity Certificate</option>
            <option value="PSTM Certificate">PSTM Certificate</option>
            <option value="OBC Certificate">OBC Certificate</option>
            <option value="Voter ID">Voter ID</option>
            <option value="PAN Card">PAN Card</option>
          </select>
        </div>

        <p style="color:gray">Document uploads are optional (you may submit without uploading).</p>

        <div class="form-row">
          <label>Passport Size Photo (optional)</label>
          <input type="file" name="file_photo" accept=".jpg,.jpeg,.png,.pdf">
        </div>

        <div class="form-row">
          <label>Aadhaar Card (optional)</label>
          <input type="file" name="file_aadhaar" accept=".jpg,.jpeg,.png,.pdf">
        </div>

        <div class="form-row">
          <label>Ration Card (optional)</label>
          <input type="file" name="file_ration" accept=".jpg,.jpeg,.png,.pdf">
        </div>

        <div class="form-row">
          <label>Signature (optional)</label>
          <input type="file" name="file_signature" accept=".jpg,.jpeg,.png,.pdf">
        </div>

        <div style="margin-top:12px">
          <button type="submit" id="submitBtn" class="btn primary">Submit</button>
          <span id="form-status" class="status"></span>
        </div>
      </form>

      <p id="successMessage" style="display:none; color:green; font-weight:bold; margin-top:10px;">
        ✅ Thanks for contacting JD Communication Services!<br>
        Our service team will contact you soon.
      </p>
    </main>

    <footer class="footer">Contact: jdguru2310@gmail.com • © 2025 JD Communication Services</footer>
  </div>

  <!-- ONLY use the official browser SDK once -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    // == CONFIG - your EmailJS keys (already provided)
    const EMAILJS_PUBLIC_KEY = "ApO3bNQPrRL95pI1G";
    const EMAILJS_SERVICE_ID = "service_7fwtzfa";
    const EMAILJS_TEMPLATE_ID = "template_bne8zmp";

    // init
    emailjs.init(ApO3bNQPrRL95pI1G);

    // form handling
    const form = document.getElementById('serviceForm');
    const statusEl = document.getElementById('form-status');
    const successEl = document.getElementById('successMessage');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      statusEl.textContent = 'Sending...';
      submitBtn.disabled = true;

      // debug: enumerate files and sizes (helpful for diagnosing attachment limits)
      const fileInputs = Array.from(form.querySelectorAll('input[type="file"]'));
      const filesInfo = fileInputs.map(fi => {
        const f = fi.files[0];
        return { name: fi.name, fileName: f ? f.name : 'no-file', size: f ? f.size : 0 };
      });
      console.info('Files being sent:', filesInfo);

      // send via EmailJS - sendForm will include file inputs as attachments if provided
      emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, form)
        .then(function(response) {
          console.info('EmailJS success:', response);
          statusEl.textContent = '';
          successEl.style.display = 'block';
          form.reset();
          // hide after a while
          setTimeout(()=> successEl.style.display = 'none', 8000);
        }, function(error) {
          // detailed error logging
          console.error('EmailJS error (full):', error);
          // build friendly message
          let errMsg = 'Error sending request. Please try again.';
          try {
            if (error && error.status) errMsg += ' (status: ' + error.status + ')';
            if (error && error.text) errMsg += ' — ' + error.text;
          } catch(e){}
          statusEl.textContent = errMsg;
          alert(errMsg + '\\nCheck browser console for details.');
        })
        .finally(function() {
          submitBtn.disabled = false;
        });
    });
  </script>
</body>
</html>
